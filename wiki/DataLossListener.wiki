#summary Data loss listener for Coherence.
#labels Featured

= Introduction =

Its a rare but possible situation, when data stored in Coherence cluster is lost (due to hardware fault, network partitioning, or even software bug). 
Since Coherence version 3.3, there is a PARTITION_LOST event type declared in com.tangosol.net.partition.!PartitionEvent class, and corresponding !PartiotionListener may be implemented. However, stability of this solution is not proven yet, and we decided to implement custom, version-independent and 100% reliable solution here in !GridDynamics Coherence team.

= Solution =

All distributed data within partitioned Coherence cache ({{{distributed-scheme}}}) is stored, replicated, and rebalanced among cluster nodes in partitions. Number of partitions is fixed (though it may be configured in cache config).
That's why one cannot lose a separate key in the cluster - minimal unit of loss is a whole partition. Partition spans through all caches create using single _partitioned cache service_, so you will loose exactly same portion of data in all these caches.

Proposed solution consists of a special marker cache, called "Canary cache" (Â©Alexey Ragozin), and a !PartitionListener implementation, listening for partition movement events (as of Coherence 3.6.1, these include PARTITION_LOST, PARTITION_TRANSMIT_ROLLBACK and PARTITION_TRANSMIT_COMMIT) and checking "canary cache" size. Cache contains exactly _partitionNumber_ entries, one per partition. Other said, each cache partition contains one and only one "canary cache" entry.

If some cluster nodes crash or other way become inaccessible, tearing down both primary and backup copies of particular cache partitions, these partitions are considered lost. "Canary cache" looses markers for these partitions and its size will get reduced. This solution does not depend on deployed version of Oracle Coherence, does not bring significant overhead due to asynchronous implementation, and enables custom, application-provided recovery or stopping logic.

= Source code and documentation =

Both jar-files, javadocs and source code are available via maven:

{{{
<dependency>
    <groupId>org.gridkit.coherence-tools</groupId>
    <artifactId>coherence-dataloss-listener</artifactId>
    <version>0.9.0</version>
</dependency>
}}}

Don't forget to add [MavenRepo GridKit Maven Repository] to your parent POM to get this dependency properly resolved.

= Resources =

Follow these links to get additional information on Coherence data loss listener configuration and usage.
  * [HowToDataLossListener Configuration and usage]